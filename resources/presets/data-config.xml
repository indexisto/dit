<dataConfig>

	<!-- author (by author_id), join to validate activeness -->

	<dataSource type="JdbcDataSource" driver="com.mysql.jdbc.Driver"
		url="jdbc:mysql://localhost/bitrix" user="root" password="s2s" />
	
	<document name="doc">
		<entity name="blog_post"
			query="SELECT 
			id, blog_id, author_id,  
			title, detail_text, 
			date_create, date_publish, 
			keywords, views
			FROM b_blog_post WHERE publish_status='P'">
			
 			<entity name="blog"
				query="SELECT name AS blog_name   
				FROM b_blog 
				WHERE id='${blog_post.blog_id}'">
			</entity>
			<entity name="blog_comments" 
				query="SELECT post_text AS comment_texts, id AS comment_ids 
				FROM b_blog_comment 
				WHERE post_id='${blog_post.id}' AND publish_status='P'">
			</entity>
			<entity name="blog_category" 
				query="SELECT bc.name AS blog_categories 
				FROM b_blog_post_category bpc, b_blog_category bc 
				WHERE bpc.post_id = '${blog_post.id}' 
				AND bpc.category_id = bc.id">
			</entity>
			<entity name="blog_post_author"
			 	transformer="TemplateTransformer" 
				query="SELECT name, last_name, email
				FROM b_user  
				WHERE id = '${blog_post.author_id}'">
				<field column="blog_post_author" template="${blog_post_author.name} ${blog_post_author.last_name} (${blog_post_author.email})" />
			</entity>		
		</entity>

		<entity name="forum_message"
			query="SELECT 
			id, forum_id, topic_id, attach_img, 
			post_date, post_message, post_message_html,
			author_name
			FROM b_forum_message WHERE approved='Y'">
			<entity name="forum_topic"
				query="SELECT title AS forum_topic_title   
				FROM b_forum_topic 
				WHERE id='${forum_message.topic_id}' AND approved='Y' ">
			</entity>
			<entity name="forum" 
				query="SELECT name AS forum_name   
				FROM b_forum 
				WHERE id='${forum_message.forum_id}' AND active='Y'">
			</entity>			
		</entity>
	</document>
  
</dataConfig>